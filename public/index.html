<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ALEXATRON AI - Universal Dashboard</title>
    <style>
        :root { --neon: #00ff88; --bg: #0b0f1a; }
        body { background: var(--bg); color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 40px; }
        .orb { width: 130px; height: 130px; border-radius: 50%; background: radial-gradient(circle, var(--neon) 0%, #064e3b 100%); cursor: pointer; box-shadow: 0 0 25px rgba(0,255,136,0.4); transition: 0.3s; }
        .orb.active { transform: scale(1.1); box-shadow: 0 0 50px var(--neon); animation: pulse 1s infinite alternate; }
        #chat { width: 100%; max-width: 550px; height: 300px; background: #1a1f2e; margin: 25px 0; border-radius: 12px; padding: 20px; overflow-y: auto; border: 1px solid #2d3748; }
        .input-box { display: flex; width: 100%; max-width: 550px; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: none; background: #2d3748; color: white; outline: none; }
        button { padding: 12px 20px; background: var(--neon); border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: #0b0f1a; }
        @keyframes pulse { from { opacity: 0.6; } to { opacity: 1; } }
    </style>
</head>
<body>
    <h1>ALEXATRON AI</h1>
    <div id="orb" class="orb" onclick="startMic()"></div>
    <p id="status">Status: Standby</p>

    <div id="chat"></div>

    <div class="input-box">
        <input type="text" id="userInput" placeholder="Ask Alexatron something...">
        <button onclick="sendText()">SEND</button>
    </div>

    <script>
        const chat = document.getElementById('chat');
        const status = document.getElementById('status');
        const orb = document.getElementById('orb');

        async function sendText() {
            const input = document.getElementById('userInput');
            const msg = input.value.trim();
            if (!msg) return;

            chat.innerHTML += `<div><b style="color:#888">You:</b> ${msg}</div>`;
            input.value = "";
            status.innerText = "Status: Thinking...";
            orb.classList.add('active');

            try {
                const response = await fetch('/ask-text', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg })
                });

                const data = await response.json();
                const aiReply = data.reply || "Error: No response.";

                chat.innerHTML += `<div style="margin-top:10px"><b style="color:#00ff88">Alexatron:</b> ${aiReply}</div>`;
                chat.scrollTop = chat.scrollHeight;

                if (data.audioUrl) {
                    status.innerText = "Status: Speaking...";
                    const audio = new Audio(data.audioUrl);
                    audio.play();
                    audio.onended = () => {
                        status.innerText = "Status: Ready";
                        orb.classList.remove('active');
                    };
                }
            } catch (err) {
                status.innerText = "Status: Server Connection Error";
                orb.classList.remove('active');
            }
        }

        function startMic() {
            const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRec) return alert("Browser not supported");
            const rec = new SpeechRec();
            rec.onstart = () => { status.innerText = "Status: Listening..."; orb.classList.add('active'); };
            rec.onresult = (e) => {
                document.getElementById('userInput').value = e.results[0][0].transcript;
                sendText();
            };
            rec.onend = () => { if(status.innerText === "Status: Listening...") orb.classList.remove('active'); };
            rec.start();
        }
    </script>
</body>
</html>
