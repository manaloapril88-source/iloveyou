<!DOCTYPE html>
<html>
<head>
    <title>ALEXATRON TESTER</title>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; text-align: center; padding: 50px; }
        .orb { width: 100px; height: 100px; background: #00ff88; border-radius: 50%; margin: 20px auto; cursor: pointer; transition: 0.3s; box-shadow: 0 0 20px #00ff88; }
        .active { transform: scale(1.2); box-shadow: 0 0 50px #00ff88; }
        input { padding: 10px; width: 300px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: #00ff88; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #chat { margin-top: 30px; color: #94a3b8; }
    </style>
</head>
<body>
    <h1>ALEXATRON WEB TESTER</h1>
    <div id="orb" class="orb" onclick="startWebSpeech()"></div>
    <p id="status">Click Orb to Speak or Type below</p>
    
    <input type="text" id="userInput" placeholder="Type message...">
    <button onclick="sendText()">SEND</button>

    <div id="chat"></div>

    <script>
        async function sendText() {
            const msg = document.getElementById('userInput').value;
            const status = document.getElementById('status');
            status.innerText = "Thinking...";
            
            const res = await fetch('/ask-text', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ message: msg })
            });
            const data = await res.json();
            
            document.getElementById('chat').innerHTML = `<b>AI:</b> ${data.reply}`;
            status.innerText = "Playing Audio...";
            
            const audio = new Audio(data.audioUrl);
            audio.play();
        }

        // Web Speech API for testing without ESP32
        function startWebSpeech() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            const orb = document.getElementById('orb');
            
            recognition.onstart = () => orb.classList.add('active');
            recognition.onresult = (event) => {
                document.getElementById('userInput').value = event.results[0][0].transcript;
                sendText();
            };
            recognition.onend = () => orb.classList.remove('active');
            recognition.start();
        }
    </script>
</body>
</html>
