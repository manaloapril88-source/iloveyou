<!DOCTYPE html>
<html>
<head>
    <title>ALEXATRON DASHBOARD</title>
    <style>
        body { background: #0b0f1a; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .orb { width: 100px; height: 100px; background: cyan; border-radius: 50%; margin: 20px auto; transition: 0.3s; box-shadow: 0 0 20px cyan; cursor: pointer; }
        .active { background: #00ff88; box-shadow: 0 0 40px #00ff88; transform: scale(1.1); }
        #chat { max-width: 500px; margin: 20px auto; background: #1a202c; padding: 15px; border-radius: 10px; height: 200px; overflow-y: auto; text-align: left; }
        input { padding: 10px; width: 70%; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: cyan; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ALEXATRON AI</h1>
    <div id="orb" class="orb" onclick="startMic()"></div>
    <p id="status">System Standby</p>
    <div id="chat"></div>
    <input type="text" id="userInput" placeholder="Ask Alexatron...">
    <button onclick="sendText()">SEND</button>

    <script>
        async function sendText() {
            const input = document.getElementById('userInput');
            const msg = input.value;
            if(!msg) return;
            
            document.getElementById('status').innerText = "Thinking...";
            const chat = document.getElementById('chat');
            chat.innerHTML += `<p style='color:gray'>You: ${msg}</p>`;
            input.value = "";

            const res = await fetch('/ask-text', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ message: msg })
            });
            const data = await res.json();
            
            chat.innerHTML += `<p><b>AI:</b> ${data.reply}</p>`;
            chat.scrollTop = chat.scrollHeight;
            document.getElementById('status').innerText = "Speaking...";
            
            const audio = new Audio(data.audioUrl);
            audio.play();
            audio.onended = () => document.getElementById('status').innerText = "Ready";
        }

        function startMic() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.onstart = () => document.getElementById('orb').classList.add('active');
            recognition.onresult = (e) => {
                document.getElementById('userInput').value = e.results[0][0].transcript;
                sendText();
            };
            recognition.onend = () => document.getElementById('orb').classList.remove('active');
            recognition.start();
        }
    </script>
</body>
</html>
